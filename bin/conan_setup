#!/bin/bash

set -eu

declare -r OS_NAME=$(uname -a | cut -f 1 -d ' ')

echo "[INFO] Setting up Conan packages for ${OS_NAME} variant"

if [[ ${OS_NAME} == "Linux" ]]; then
    BUILD_DIR="$(dirname $0)/../.conan"
    CLANG=clang
    CLANG_VERSION=${1:-4.0}
    C11="11"
elif [[ ${OS_NAME} == "Darwin" ]]; then
    BUILD_DIR="$(dirname $0)/../mac.conan"
    CLANG=apple-clang
    CLANG_VERSION=${1:-9.0}
    C11=""
else
    echo "[ERROR] Unsupported Linux variant: ${OS_NAME}"
    exit 1
fi

mkdir -p ${BUILD_DIR} && cd ${BUILD_DIR}
conan install .. -s compiler=${CLANG} \
                 -s compiler.version=${CLANG_VERSION} \
                 -s compiler.libcxx=libstdc++${C11} \
                 --build=missing
